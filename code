
const byte ledPin = 17;
const byte interruptPin = 16;
volatile byte state = LOW;

//Number of pulses, used to measure energy.
long pulseCount = 0;

//Used to measure power.
unsigned long pulseTime,lastTime;

//power and energy
double power, elapsedkWh;


void setup()
{
    Serial.begin(115200);
    attachInterrupt(digitalPinToInterrupt(interruptPin), blink, FALLING);
}

void loop()
{
    digitalWrite(ledPin, state);
}

// The interrupt routine
void blink()
{
    //De tijd tussen pulses.
    lastTime = pulseTime;
    pulseTime = micros();

    //pulseCounter
    pulseCount++;

    //Joule berekenen.
    power = (3600000000.0 / (pulseTime - lastTime))/2;

    //Hoeveelheid kWh opgewekt.
    elapsedkWh = (1.0*pulseCount/2000); 
    
    state = !state;

    //Huidige waarden printen.
    Serial.print("Het huidige verbruik is: ");
    Serial.print(power,4);
    Serial.print(" watt.");
    Serial.print(" De opbrengst is: ");
    Serial.print(elapsedkWh,3);
    Serial.println(" kWh.");
}
